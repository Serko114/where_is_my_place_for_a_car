# [парковка]

## Цель: 
### 1. Вычислять наличие пустых мест на парковке в текущий момент
### 2. Собирать статистику по наличию пустых мест в зависимости от времени суток, сезона, может быть погоды.




>Т.к. вида сверху нет, места не расчерчены и машины могут боле менее стоять как попало, будем действовать таким образом, для начала обучу семантическую сегментацию с помощью Unet. В которой будут две маски, одна маска - это площаь парковки без учета наличия машин, вторая - площадь парковки с удаленными из маски машинами. Да, еще есть проезд, который всегда есть, буду его учитывать в процентром соотношении от всей площади парковки (пропорцию найду, кагда вся парковка будет занята). В результате две маски будут сравниваться пропорционально, чем выше число от 0 до 1, тем свободней парковка. Назначаем порог, выше которого данные просто будут отправляться в БД, если порог будет низким, то данные будут передаваться в следующую можель. 
>
>Следующая модель: это будет модель детекции YOLOv8 c повернутыми Bbox-ами, которая будет обучена на почти полной парковке, с целью поиска конкретных свободных мест (конкретный подсчет). Т.к. имеетместо перспектива и места расположенные дальше смотрятся пеньше, поэтому возможно придется ввести коэффициент: разбить экран горизонтальными линиями и чем выше свободное место (выше - это значит дальше), тем выше коэффициент, т.к. удалением места визуально уменьшаются, ну здесь еще посмотрим. Возможно это будет и сегментация еще одна


![Пример](data_for_readme/segm_all.png)

Результат обучения модели Unet можно видеть ниже:
![Пример](data_for_readme/segm_res_all.png)

По картинке видно, что модель Unet обучяется боле менее хорошо, в принципе такое качество достаточно, чтобы в первом приближении определить есть пустые парковочные места или их нет. 
Математическая часть: вводим коффициент, т.к. камера у нас может передвигаться и парковку +/- видно по-разному, поэтому находит отношение пятен машин к участку парковки без машин и выводим график, где визуально видно, что кэффициенты фактического отношения и предсказаннго довольно близки:


![Пример](data_for_readme/output.png)

Пороговым коэффициентом исходя из графика возьмем значение 0.58, т.е. значение ниже будет определять, что свободные места есть 100%, а если значение будет выше, то данные будут передаваться в следующую нейронку YOLOv8, которая будет обучена находить повернутые баундинбоксы (пустые места) и их количество.